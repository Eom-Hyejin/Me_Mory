<!DOCTYPE HTML>
<html lang="ko">
<head>
  <title>Memory</title>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta content="text/html; charset=UTF-8; X-Content-Type-Options=nosniff" http-equiv="Content-Type">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0, viewport-fit=cover">
  <meta name="theme-color" content="#162060" />
  <meta property="og:image" content="./asset/images/layout/img_thumbnail.png">

  <link rel="stylesheet" href="./asset/css/swiper.min.css">
  <link rel="stylesheet" href="./asset/css/base.css">
  <link rel="stylesheet" href="./asset/css/grid.css?a=2">
  <link rel="stylesheet" href="./asset/css/common.css?a=1">
  <link rel="stylesheet" href="./asset/css/layout.css">
</head>
<body>
  <!-- Header (공통 네비) -->
  <header>
    <div class="container">
      <div class="header-logo">
        <h1><a href="/"><img src="./asset/images/logo.png" alt="Me:mory"></a></h1>
      </div>
      <div class="header-cate">
        <ul>
          <li><a href="/record.html">감정기록</a></li>
          <li><a href="/calendar.html">감정캘린더</a></li>
          <li><a href="/around.html">내 주변 감정</a></li>
          <li><a href="/map.html">감정지도</a></li>
          <li><a href="/memory.html">감정회고</a></li>
        </ul>
      </div>
      <div class="header-right">
        <div class="right-button">
          <ul>
            <li class="border"><a href="/login_02.html">로그인</a></li>
            <li><a href="/register_01.html">회원가입</a></li>
          </ul>
        </div>
        <div class="right-menu">
          <button type="button" class="menu" onclick="activeParent(this, 'right-menu');">메뉴바</button>
          <div class="inner">
            <ul>
              <li><a href="/record.html">감정기록</a></li>
              <li><a href="/calendar.html">감정캘린더</a></li>
              <li><a href="/around.html">내 주변 감정</a></li>
              <li><a href="/map.html">감정지도</a></li>
              <li><a href="/memory.html">감정회고</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </header>

  <section>
    <div class="container container-sm">
      <div class="title-box">
        <h2>아이디 / 비밀번호 찾기</h2>
      </div>

      <!-- 아이디 찾기 -->
      <div class="inner-box">
        <div class="member-box">
          <div class="title-box md">
            <h3>아이디 찾기</h3>
            <p>가입시 작성하신 이름과 이메일 주소를 입력하시면 <br/>아이디를 알려드립니다.</p>
          </div>
          <div class="write-box">
            <ul>
              <li class="full">
                <strong class="req">이름</strong>
                <div class="input-box input-lg">
                  <input type="text" id="findIdName" placeholder="실명을 입력해 주세요"/>
                </div>
              </li>
              <li class="full">
                <strong class="req">이메일</strong>
                <div class="input-box input-lg">
                  <input type="text" id="findIdEmail" placeholder="이메일 주소를 입력해 주세요"/>
                </div>
              </li>
            </ul>
          </div>
          <div class="button-box mt40 mt-lg-32">
            <a href="javascript:;" id="btnFindId" class="btn btn-active">아이디 찾기</a>
          </div>
        </div>
      </div>

      <!-- 비밀번호 찾기 -->
      <div class="inner-box mt24 mt-lg-16">
        <div class="member-box">
          <div class="title-box md">
            <h3>비밀번호 찾기</h3>
            <p>가입시 작성하신 아이디, 이름, 이메일 주소를 입력하시면 <br/>임시비밀번호를 알려드립니다.</p>
          </div>
          <div class="write-box">
            <ul>
              <li class="full">
                <strong class="req">아이디</strong>
                <div class="input-box input-lg">
                  <input type="text" id="findPwUsername" placeholder="아이디를 입력해 주세요"/>
                </div>
              </li>
              <li class="full">
                <strong class="req">이름</strong>
                <div class="input-box input-lg">
                  <input type="text" id="findPwName" placeholder="실명을 입력해 주세요"/>
                </div>
              </li>
              <li class="full">
                <strong class="req">이메일</strong>
                <div class="input-box input-lg">
                  <input type="text" id="findPwEmail" placeholder="이메일 주소를 입력해 주세요"/>
                </div>
              </li>
            </ul>
          </div>
          <div class="button-box mt40 mt-lg-32">
            <a href="javascript:;" id="btnFindPw" class="btn btn-active">비밀번호 찾기</a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- 모달: 아이디 -->
  <div class="modal-box modal-sm" id="modal-id" role="dialog" aria-hidden="true">
    <div class="box">
      <div class="modal-head">
        <h2>아이디 찾기 결과</h2>
        <a href="javascript:;" class="close" onclick="modalClose(this);">닫기</a>
      </div>
      <div class="modal-body">
        <p>가입한 아이디는 <b id="foundId"></b> 입니다.</p>
      </div>
      <div class="modal-foot">
        <div class="button-box">
          <a href="javascript:;" class="btn btn-active btn-lg flex-lg-1" onclick="modalClose(this)">확인</a>
        </div>
      </div>
    </div>
  </div>

  <!-- 모달: 비밀번호 -->
  <div class="modal-box modal-sm" id="modal-pw" role="dialog" aria-hidden="true">
    <div class="box">
      <div class="modal-head">
        <h2>비밀번호 찾기 결과</h2>
        <a href="javascript:;" class="close" onclick="modalClose(this);">닫기</a>
      </div>
      <div class="modal-body">
        <p>임시 비밀번호는 <b id="foundPw"></b> 입니다.<br/>로그인 후 반드시 변경해주세요.</p>
      </div>
      <div class="modal-foot">
        <div class="button-box">
          <a href="javascript:;" class="btn btn-active btn-lg flex-lg-1" onclick="modalClose(this)">확인</a>
        </div>
      </div>
    </div>
  </div>

  <div class="bg-box">
    <img src="./asset/images/bg_body_member.png" class="is-pc"/>
    <img src="./asset/images/bg_body_member_m.png" class="is-m"/>
  </div>

  <script src="./asset/js/swiper.js?a=1"></script>
  <script src="/asset/js/app.js?ver=19"></script>

  <script>
  // ===== 아이디 찾기 =====
  document.getElementById('btnFindId').addEventListener('click', async () => {
    const name = document.getElementById('findIdName').value.trim();
    const email = document.getElementById('findIdEmail').value.trim();
    if (!name || !email) {
      return alert("이름과 이메일을 모두 입력해주세요.");
    }
    try {
      const res = await fetch('/api/auth/find-id', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, email })
      });
      const data = await res.json();
      if (res.ok) {
        document.getElementById('foundId').textContent = data.username;
        modalOpen(null, document.getElementById('modal-id'));
      } else {
        alert(data.message || "아이디 찾기 실패");
      }
    } catch (err) {
      alert("서버 오류: " + err.message);
    }
  });

  // ===== 비밀번호 찾기 =====
  document.getElementById('btnFindPw').addEventListener('click', async () => {
    const username = document.getElementById('findPwUsername').value.trim();
    const name = document.getElementById('findPwName').value.trim();
    const email = document.getElementById('findPwEmail').value.trim();
    if (!username || !name || !email) {
      return alert("아이디, 이름, 이메일을 모두 입력해주세요.");
    }
    try {
      const res = await fetch('/api/auth/find-pw', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, name, email })
      });
      const data = await res.json();
      if (res.ok) {
        document.getElementById('foundPw').textContent = data.tempPassword;
        modalOpen(null, document.getElementById('modal-pw'));
      } else {
        alert(data.message || "비밀번호 찾기 실패");
      }
    } catch (err) {
      alert("서버 오류: " + err.message);
    }
  });

  // ===== 모달 열기/닫기 =====
  function modalOpen(e, el) {
    const target = typeof el === "string" ? document.getElementById(el) : el;
    if (target) target.style.display = "block";
  }
  function modalClose(el) {
    el.closest(".modal-box").style.display = "none";
  }
  </script>
</body>
</html>