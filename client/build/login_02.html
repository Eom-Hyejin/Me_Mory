<!DOCTYPE HTML>
<html lang="ko">
<head>
  <title>Memory</title>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta content="text/html; charset=UTF-8; X-Content-Type-Options=nosniff" http-equiv="Content-Type">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0, viewport-fit=cover">
  <meta name="theme-color" content="#162060" />
  <meta property="og:image" content="./asset/images/layout/img_thumbnail.png">

  <!-- CSS -->
  <link rel="stylesheet" href="./asset/css/swiper.min.css">
  <link rel="stylesheet" href="./asset/css/base.css">
  <link rel="stylesheet" href="./asset/css/grid.css?a=2">
  <link rel="stylesheet" href="./asset/css/common.css?a=1">
  <link rel="stylesheet" href="./asset/css/layout.css">
</head>
<body>
  <!-- Header (공통 네비게이션: header.js가 제어) -->
  <header>
    <div class="container">
      <div class="header-logo">
        <h1><a href="/"><img src="./asset/images/logo.png" alt="Me:mory"></a></h1>
      </div>
      <div class="header-cate">
        <ul>
          <li><a href="#" data-nav="record">감정기록</a></li>
          <li><a href="#" data-nav="calendar">감정캘린더</a></li>
          <li><a href="#" data-nav="around">내 주변 감정</a></li>
          <li><a href="#" data-nav="map">감정지도</a></li>
          <li><a href="#" data-nav="memory">감정회고</a></li>
        </ul>
      </div>
      <div class="header-right">
        <div class="right-button">
          <ul>
            <li class="border"><a href="#" data-nav="login">로그인</a></li>
            <li><a href="#" data-nav="register">회원가입</a></li>
          </ul>
        </div>
        <div class="right-menu">
          <button type="button" class="menu" onclick="activeParent(this, 'right-menu');">메뉴바</button>
          <div class="inner">
            <ul>
              <li><a href="#" data-nav="record">감정기록</a></li>
              <li><a href="#" data-nav="calendar">감정캘린더</a></li>
              <li><a href="#" data-nav="around">내 주변 감정</a></li>
              <li><a href="#" data-nav="map">감정지도</a></li>
              <li><a href="#" data-nav="memory">감정회고</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Body -->
  <section>
    <div class="full-box">
      <div class="full-inner full-height">
        <div class="container container-sm">
          <div class="logo-box">
            <h2><img src="./asset/images/logo.png" class="sm" alt="Me:mory"/></h2>
            <p class="su is-pc">나의 감정 우주로 떠나는 타임캡슐 여행</p>
          </div>

          <div class="member-box mt48 mt-lg-40">
            <div class="input-title-box is-m">
              <strong>아이디를 입력해주세요</strong>
            </div>
            <div class="input-box input-icon input-id mt-lg-12">
              <input type="text" id="loginId" placeholder="아이디를 입력해 주세요" autocomplete="username"/>
            </div>

            <div class="input-title-box is-m mt20">
              <strong>비밀번호를 입력해주세요</strong>
            </div>
            <div class="input-box input-icon input-pw mt16 mt-lg-12">
              <input type="password" id="password" placeholder="비밀번호를 입력해 주세요" autocomplete="current-password"/>
            </div>

            <div class="check-box mt24 mt-lg-16">
              <input type="checkbox" id="autoLogin"/>
              <label for="autoLogin">자동 로그인</label>
            </div>

            <div class="button-box mt32">
              <a href="#" id="btnLogin" class="btn btn-active">로그인</a>
            </div>

            <div class="member-link mt24 mt-lg-20">
              <ul>
                <li><a href="/find.html">아이디/비밀번호 찾기</a></li>
                <li><a href="/register_01.html" class="ft-active">회원가입</a></li>
              </ul>
            </div>
          </div><!-- /.member-box -->
        </div>
      </div>
    </div>
  </section>

  <!-- BG -->
  <div class="bg-box">
    <img src="./asset/images/bg_body_member.png" class="is-pc" alt="">
    <img src="./asset/images/bg_body_member_m.png" class="is-m" alt="">
  </div>

  <!-- Scripts -->
  <script src="./asset/js/swiper.js?a=1" defer></script>
  <script src="/asset/js/app.js?ver=22" defer></script>
  <!-- 공통 헤더 스크립트 (세션검증/네비게이션) -->
  <script src="/asset/js/header.js?v=1" defer></script>

  <!-- 페이지 전용 스크립트 -->
  <script>
    // 로그인 처리
    document.addEventListener('DOMContentLoaded', () => {
      const $ = (s) => document.querySelector(s);

      $('#btnLogin').addEventListener('click', async (e) => {
        e.preventDefault();

        const loginId = $('#loginId').value.trim();
        const password = $('#password').value.trim();

        if (!loginId || !password) {
          alert('로그인이 불가능합니다.\n(아이디와 비밀번호를 모두 입력해주세요)');
          return;
        }

        try {
          const res = await fetch('/api/auth/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ loginId, password })
          });

          if (!res.ok) {
            const err = await res.json().catch(()=>({}));
            throw new Error(err.message || '로그인 실패');
          }

          const data = await res.json();
          // 토큰 저장
          if (data?.token)        localStorage.setItem('accessToken', data.token);
          if (data?.refreshToken) localStorage.setItem('refreshToken', data.refreshToken);

          // 자동로그인(선택): 체크되어 있지 않아도 기본은 로컬스토리지라 유지됩니다.
          // 필요 시 쿠키/만료 로직을 여기서 확장 가능.

          // 메인으로
          window.location.href = '/index.html';
        } catch (err) {
          alert('로그인 실패: ' + (err.message || '서버 오류'));
        }
      });
    });
  </script>
</body>
</html>