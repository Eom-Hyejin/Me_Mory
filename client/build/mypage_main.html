<!DOCTYPE HTML>
<html lang="ko">
<head>
  <title>Memory</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0, viewport-fit=cover">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta content="text/html; charset=UTF-8; X-Content-Type-Options=nosniff" http-equiv="Content-Type">
  <meta name="theme-color" content="#162060" />
  <meta property="og:image" content="./asset/images/layout/img_thumbnail.png">
  <link rel="stylesheet" type="text/css" href="./asset/css/swiper.min.css">
  <link rel="stylesheet" type="text/css" href="./asset/css/base.css">
  <link rel="stylesheet" type="text/css" href="./asset/css/grid.css?a=2">
  <link rel="stylesheet" type="text/css" href="./asset/css/common.css?a=1">
  <link rel="stylesheet" type="text/css" href="./asset/css/layout.css">
  <script src="./asset/js/jquery-3.3.1.js"></script>
  <script src="./asset/js/swiper.min.js"></script>
  <script src="./asset/js/common.js?a=2"></script>
  <style>
    .is-hidden{display:none!important}
    header .header-right .header-user a[data-nav="logout"],
    header .header-right .right-menu .inner ul .header-user-item.ye > a[data-nav="logout"]{
      background:#ffcc00!important;color:#fff!important;padding:8px 14px;border-radius:6px;font-weight:bold;display:block;width:fit-content;margin-left:auto;text-align:center}
    header a[data-nav="logout"]:hover, header a[data-nav="logout"]:focus{filter:brightness(.9)}
    #profile-img{object-fit:cover;border-radius:50%}
  </style>
</head>
<body>
<header>
  <div class="container">
    <div class="header-logo">
      <h1><a href="/"><img src="./asset/images/logo.png" alt="Memory"/></a></h1>
    </div>

    <div class="header-cate">
      <ul>
        <li><a href="#" data-nav="record">ê°ì •ê¸°ë¡</a></li>
        <li class="active"><a href="#" data-nav="calendar">ê°ì •ìº˜ë¦°ë”</a></li>
        <li><a href="#" data-nav="around">ë‚´ ì£¼ë³€ ê°ì •</a></li>
        <li><a href="#" data-nav="map">ê°ì •ì§€ë„</a></li>
        <li><a href="#" data-nav="memory">ê°ì •íšŒê³ </a></li>
      </ul>
    </div>

    <div class="header-right">
      <div class="right-button header-guest">
        <ul>
          <li class="border"><a href="#" data-nav="login">ë¡œê·¸ì¸</a></li>
          <li><a href="#" data-nav="register">íšŒì›ê°€ì…</a></li>
        </ul>
      </div>
      <div class="right-button header-user is-hidden">
        <ul>
          <li class="border"><a href="#" data-nav="mypage">ë§ˆì´í˜ì´ì§€</a></li>
          <li><a href="#" data-nav="logout">ë¡œê·¸ì•„ì›ƒ</a></li>
        </ul>
      </div>

      <div class="right-menu">
        <button type="button" class="menu" onclick="activeParent(this, 'right-menu');">ë©”ë‰´ë°”</button>
        <div class="inner">
          <ul>
            <li><a href="#" data-nav="record">ê°ì •ê¸°ë¡</a></li>
            <li><a href="#" data-nav="calendar">ê°ì •ìº˜ë¦°ë”</a></li>
            <li><a href="#" data-nav="around">ë‚´ ì£¼ë³€ ê°ì •</a></li>
            <li><a href="#" data-nav="map">ê°ì •ì§€ë„</a></li>
            <li><a href="#" data-nav="memory">ê°ì •íšŒê³ </a></li>
            <li class="header-user-item is-hidden"><a href="#" data-nav="mypage">ë§ˆì´í˜ì´ì§€</a></li>
            <li class="header-user-item is-hidden ye"><a href="#" data-nav="logout">ë¡œê·¸ì•„ì›ƒ</a></li>
            <li class="header-guest-item"><a href="#" data-nav="login">ë¡œê·¸ì¸</a></li>
            <li class="header-guest-item"><a href="#" data-nav="register">íšŒì›ê°€ì…</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</header>

<section>
  <div class="container container-xl">
    <div class="title-box">
      <h2>ë§ˆì´í˜ì´ì§€</h2>
    </div>

    <div class="mypage-top-box">
      <div class="top-left">
        <div class="left-text">
          <h2><b id="nickname">ë©”ëª¨ë¦¬</b>ë‹˜, <br/>ì˜¤ëŠ˜ì€ ì–´ë–¤ í•˜ë£¨ì¸ê°€ìš”?</h2>
          <div class="button-box">
            <a href="#" class="btn btn-active btn-lg" data-nav="record">ê°ì • ê¸°ë¡í•˜ëŸ¬ ê°€ê¸°</a>
          </div>
        </div>
        <div class="left-thumb">
          <div class="emotion-result-box arround lg">
            <div class="image">
              <img id="profile-img" src="./asset/images/img_arround_thumb_02.png" alt="í”„ë¡œí•„ ì´ë¯¸ì§€">
            </div>
            <!-- ì˜¤ëŠ˜ ê°ì • ì•„ì´ì½˜: ê°ì • ìˆì„ ë•Œë§Œ .result ì „ì²´ë¥¼ ë³´ì´ê²Œ -->
            <div class="result"><img id="today-emotion" alt="ì˜¤ëŠ˜ì˜ ê°ì •"></div>
          </div>
        </div>
      </div>

      <div class="top-right">
        <div class="right-head">
          <a href="#" data-nav="alert"><h2>ê°ì •íšŒê³  ì•Œë¦¼</h2></a>
          <a href="#" data-nav="notice-list"><h2>ê³µì§€ì‚¬í•­</h2></a>
        </div>
        <div class="right-body">
          <ul>
            <li><a href="#" class="inner" data-nav="alert"><p>6ê°œì›” ì „ ì˜¤ëŠ˜, íšŒê³ í•  ê°ì •ë“¤ì´ ìˆì–´ìš”!</p><time>2025-08-01</time></a></li>
            <li><a href="#" class="inner" data-nav="alert"><p>6ê°œì›” ì „ ì˜¤ëŠ˜, íšŒê³ í•  ê°ì •ë“¤ì´ ìˆì–´ìš”!</p><time>2025-08-01</time></a></li>
            <li><a href="#" class="inner" data-nav="alert"><p>6ê°œì›” ì „ ì˜¤ëŠ˜, íšŒê³ í•  ê°ì •ë“¤ì´ ìˆì–´ìš”!</p><time>2025-08-01</time></a></li>
            <li><a href="#" class="inner" data-nav="alert"><p>6ê°œì›” ì „ ì˜¤ëŠ˜, íšŒê³ í•  ê°ì •ë“¤ì´ ìˆì–´ìš”!</p><time>2025-08-01</time></a></li>
            <li><a href="#" class="inner" data-nav="alert"><p>6ê°œì›” ì „ ì˜¤ëŠ˜, íšŒê³ í•  ê°ì •ë“¤ì´ ìˆì–´ìš”!</p><time>2025-08-01</time></a></li>
          </ul>
        </div>
      </div>
    </div>

    <div class="mypage-bottom-box">
      <div class="bottom-left">
        <div class="left-inner">
          <div class="emotion-year-box">
            <h2>2025ë…„ 8ì›”ì˜ ë‚´ ê°ì •ì€?</h2>
            <div class="image">
              <ul></ul>
            </div>
            <div class="text">
              <ul></ul>
            </div>
          </div>
        </div>

        <div class="left-link"><a href="#" data-nav="mypage-update"><h2>ë‚´ ì •ë³´ ìˆ˜ì •í•˜ê¸°</h2></a></div>
        <div class="left-link"><a href="#"><h2>ì•± ì„¤ì •</h2></a></div>
        <div class="left-link"><a href="#"><h2>ê³ ê°ì„¼í„°</h2></a></div>
      </div>

      <div class="bottom-right">
        <div class="notice-list-box">
          <h2>ê³µì§€ì‚¬í•­</h2>
          <ul>
            <li><a href="#" class="inner" data-nav="notice-list"><p>ğŸ“£ ê³µì§€ / ì•ˆë‚´</p><time>2025-08-01</time></a></li>
            <li><a href="#" class="inner" data-nav="notice-list"><p>ğŸ”§ ì—…ë°ì´íŠ¸ ì•ˆë‚´</p><time>2025-08-01</time></a></li>
            <li><a href="#" class="inner" data-nav="notice-list"><p>âœï¸ ëŒ“ê¸€ ì‘ì„± ì´ë²¤íŠ¸ ì•ˆë‚´</p><time>2025-08-01</time></a></li>
            <li><a href="#" class="inner" data-nav="notice-list"><p>ğŸ“£ ê³µì§€ / ì•ˆë‚´</p><time>2025-08-01</time></a></li>
            <li><a href="#" class="inner" data-nav="notice-list"><p>ğŸ“£ ê³µì§€ / ì•ˆë‚´</p><time>2025-08-01</time></a></li>
            <li><a href="#" class="inner" data-nav="notice-list"><p>ğŸ“£ ê³µì§€ / ì•ˆë‚´</p><time>2025-08-01</time></a></li>
          </ul>
          <p>ìµœê·¼ 30ì¼ê°„ ì•Œë¦¼ì„ í‘œì‹œí•´ìš”</p>
        </div>
      </div>
    </div>
  </div>
</section>

<div class="bg-box">
  <img src="./asset/images/bg_body_cate_mypage.png" class="is-pc">
  <img src="./asset/images/bg_body_cate_mypage_m.png" class="is-m">
</div>

<script src="./asset/js/swiper.js?a=1"></script>
<script src="/asset/js/app.js?ver=24"></script>
<script>
  /* ===== ê³µí†µ ìœ í‹¸ & ì¸ì¦ fetch ===== */
  const isLoggedIn = () => !!localStorage.getItem('accessToken');
  const go = (url) => (window.location.href = url);

  function authHeaders(){
    const t = localStorage.getItem('accessToken');
    // âš ï¸ ì„œë²„ê°€ 'Bearer ' ì—†ì´ í† í°ë§Œ ë°›ë„ë¡ êµ¬í˜„ë˜ì–´ ìˆìŒ
    return t ? { 'Authorization': t } : {};
  }
  function redirectToLogin(){
    const back = encodeURIComponent(location.pathname + location.search);
    window.location.href = `/login_01.html?next=${back}`;
  }
  async function fetchWithAuth(input, init = {}){
    const headers = { ...(init.headers || {}), ...authHeaders() };
    const res = await fetch(input, { ...init, headers });
    if (res.status === 401 || res.status === 403){
      localStorage.removeItem('accessToken');
      redirectToLogin();
      throw new Error('Unauthorized');
    }
    return res;
  }

  /* ===== BLE ë™ì˜ ===== */
  async function hasBleConsent() {
    if (!isLoggedIn()) return false;
    try {
      const res = await fetchWithAuth('/api/bluetooth/consent');
      if (!res.ok) return false;
      const data = await res.json();
      return !!(data && (data.enabled === 1 || data.enabled === true));
    } catch { return false; }
  }

  /* ===== í—¤ë” í† ê¸€ ===== */
  function renderHeaderByAuth() {
    const loggedIn = isLoggedIn();
    document.querySelectorAll('.header-guest, .header-guest-item').forEach(el => el.classList.toggle('is-hidden', loggedIn));
    document.querySelectorAll('.header-user, .header-user-item').forEach(el => el.classList.toggle('is-hidden', !loggedIn));
  }

  /* ===== ë„¤ë¹„ ì²˜ë¦¬ ===== */
  document.addEventListener('click', async (e) => {
    const a = e.target.closest('[data-nav]'); if (!a) return;
    e.preventDefault();
    const key = a.getAttribute('data-nav');

    if (key === 'login')    return go('/login_01.html');
    if (key === 'register') return go('/register_01.html');
    if (key === 'logout')   {
      localStorage.removeItem('accessToken'); meCache = null;
      renderHeaderByAuth(); renderNickname(); renderProfile(); renderTodayEmotion(); renderMonthTitleAndStats();
      return go('/');
    }
    if (key === 'mypage')   return isLoggedIn() ? go('/mypage_main.html') : go('/login_01.html');
    if (!isLoggedIn()) return go('/login_01.html');

    switch (key) {
      case 'record':   return go('/emotion_select_01.html');
      case 'calendar': return go('/emotion_calendar.html');
      case 'map':      return go('/emotion_map.html');
      case 'memory':   return go('/emotion_memory.html');
      case 'around': {
        const ok = await hasBleConsent();
        return go(ok ? '/emotion_arround_check_01.html' : '/emotion_arround_bluetooth.html');
      }
      case 'notice-list':   return go('/mypage_notice_list.html');
      case 'alert':         return go('/mypage_alert.html');
      case 'mypage-update': return go('/mypage_update.html');
    }
  });

  /* ===== me ìºì‹œ ===== */
  let meCache = null;
  async function getMe() {
    if (!isLoggedIn()) return null;
    if (meCache) return meCache;
    try {
      const res = await fetchWithAuth('/api/auth/me');
      if (!res.ok) return null;
      meCache = await res.json(); // { name, img, ... }
      return meCache;
    } catch { return null; }
  }

  /* ===== ê°ì • ì•„ì´ì½˜ ë§¤í•‘ ===== */
  const EMOJI_KO = { joy:'í–‰ë³µí•´ìš”', sadness:'ìŠ¬í¼ìš”', anger:'í™”ë‚˜ìš”', worry:'ë¶ˆì•ˆí•´ìš”', proud:'ë¿Œë“¯í•´ìš”', upset:'ì†ìƒí•´ìš”' };
  const EMOJI_SET = {
    joy:     ['icon_happy_02.png','icon_happy_03.png','icon_happy_04.png','icon_happy_05.png','icon_happy_06.png','icon_happy_07.png'],
    sadness: ['icon_sad_02.png','icon_sad_03.png','icon_sad_04.png','icon_sad_05.png','icon_sad_06.png','icon_sad_07.png'],
    anger:   ['icon_angry_02.png','icon_angry_03.png','icon_angry_04.png','icon_angry_05.png','icon_angry_06.png','icon_angry_07.png'],
    worry:   ['icon_uneasy_02.png','icon_uneasy_03.png','icon_uneasy_04.png','icon_uneasy_05.png','icon_uneasy_06.png','icon_uneasy_07.png'],
    proud:   ['icon_envious_02.png','icon_envious_03.png','icon_envious_04.png','icon_envious_05.png','icon_envious_06.png','icon_envious_07.png'],
    upset:   ['icon_upset_02.png','icon_upset_03.png','icon_upset_04.png','icon_upset_05.png','icon_upset_06.png','icon_upset_07.png'],
  };
  function parseExprIndex(expression_type){
    const s = String(expression_type ?? '').toLowerCase().trim();
    const m = s.match(/(\d+)/);
    let n = m ? parseInt(m[1], 10) : 2;
    if (!Number.isFinite(n)) n = 2;
    n = Math.max(1, Math.min(6, n));
    return n - 1;
  }
  function getEmojiSrc(emotion_type, expression_type){
    const list = EMOJI_SET[String(emotion_type)] || EMOJI_SET.joy;
    const idx = parseExprIndex(expression_type);
    return `./asset/images/${list[idx]}`;
  }

  /* ===== ë‹‰ë„¤ì„/í”„ë¡œí•„ ===== */
  async function renderNickname(){
    const el = document.querySelector('#nickname'); if (!el) return;
    let name = 'ë©”ëª¨ë¦¬'; const me = await getMe();
    if (me?.name) name = me.name;
    el.textContent = name;
  }
  const DEFAULT_PROFILE = './asset/images/img_arround_thumb_02.png';
  async function renderProfile(){
    const img = document.querySelector('#profile-img'); if (!img) return;
    let url = DEFAULT_PROFILE; const me = await getMe();
    if (me?.img && typeof me.img === 'string') url = me.img;
    img.onerror = () => { img.onerror = null; img.src = DEFAULT_PROFILE; };
    img.src = url;
  }

  /* ===== ì˜¤ëŠ˜ ìµœì‹  ê°ì • ===== */
  async function renderTodayEmotion(){
    const resultWrap = document.querySelector('.emotion-result-box .result');
    if (!resultWrap) return;
    // ê¸°ë³¸: ìˆ¨ê¹€ (ê°ì • ìˆìœ¼ë©´ ë³´ì—¬ì¤Œ)
    resultWrap.style.display = 'none';

    let imgEl = document.querySelector('#today-emotion');
    if (!imgEl) { imgEl = document.createElement('img'); imgEl.id = 'today-emotion'; imgEl.alt = 'ì˜¤ëŠ˜ì˜ ê°ì •'; resultWrap.appendChild(imgEl); }

    if (!isLoggedIn()) return;

    try {
      const res = await fetchWithAuth('/api/record/today/latest');
      if (res.status === 204) return;
      if (!res.ok) return;

      const data = await res.json();
      const emo  = String(data?.emotion_type || '').trim();
      const expr = data?.expression_type;
      if (!emo || !EMOJI_SET[emo]) return;

      imgEl.alt = EMOJI_KO[emo] || 'ì˜¤ëŠ˜ì˜ ê°ì •';
      imgEl.title = imgEl.alt;
      imgEl.onerror = () => { imgEl.onerror = null; resultWrap.style.display = 'none'; };
      imgEl.src = getEmojiSrc(emo, expr);

      // ê°ì • ìˆì„ ë•Œë§Œ ë§í’ì„ /ì•„ì´ì½˜ í‘œì‹œ
      resultWrap.style.display = '';
    } catch {
      resultWrap.style.display = 'none';
    }
  }

  /* ===== ì›”ë³„ ì œëª© + í†µê³„ ===== */
  async function renderMonthTitleAndStats(){
  if (!isLoggedIn()) return;
  try{
    const res = await fetchWithAuth('/api/record/month/stats?caps=10');
    if (!res.ok) return;
    const data = await res.json(); // { year, month, total, items[...] }

    // ì œëª©
    const h2 = document.querySelector('.emotion-year-box h2');
    if (h2) h2.textContent = `${data.year}ë…„ ${data.month}ì›”ì˜ ë‚´ ê°ì •ì€?`;

    // ê°ì • ë¼ë²¨ & ì•„ì´ì½˜ ë§¤í•‘
    const label = {
      joy:'í–‰ë³µí•´ìš”', worry:'ë¶ˆì•ˆí•´ìš”', sadness:'ìŠ¬í¼ìš”',
      anger:'í™”ë‚˜ìš”', proud:'ë¶€ëŸ¬ì›Œìš”', upset:'ì†ìƒí•´ìš”'
    };
    const iconByEmotion = {
      joy:'icon_happy_01.png', worry:'icon_uneasy_01.png',
      sadness:'icon_sad_01.png', anger:'icon_angry_01.png',
      proud:'icon_envious_01.png', upset:'icon_upset_01.png'
    };

    // 6ê°œ ê°ì • ê¸°ë³¸ê°’(0%) í¬í•¨í•´ì„œ ë³‘í•©
    const merged = Object.keys(label).map(em=>{
      const found = data.items.find(x=>x.emotion===em);
      return {
        emotion: em,
        percent: found ? found.percent : 0,
        caps: found ? found.caps : 0
      };
    });

    // ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
    merged.sort((a,b)=> b.percent - a.percent);

    // í¼ì„¼íŠ¸ í…ìŠ¤íŠ¸ ë Œë”
    const textUl = document.querySelector('.emotion-year-box .text ul');
    if (textUl){
      textUl.innerHTML = merged
        .map(it => `<li>${label[it.emotion]} ${it.percent}%</li>`)
        .join('');
    }

    // ì•„ì´ì½˜ ë Œë”
    const imgUl = document.querySelector('.emotion-year-box .image ul');
    if (imgUl){
      const parts = [];
      merged.forEach(it=>{
        for (let i=0;i<it.caps;i++){
          parts.push(`<li><img src="./asset/images/${iconByEmotion[it.emotion]}"></li>`);
        }
      });
      imgUl.innerHTML = parts.join('');
    }
  }catch(e){
    console.error('renderMonthTitleAndStats ì‹¤íŒ¨', e);
  }
}

/* ================= ê³µì§€ì‚¬í•­ ë Œë” ================= */
function fmtYYYYMMDD(s){
  // publish_at ê°™ì€ ë¬¸ìì—´ì„ 'YYYY-MM-DD' ë¡œ
  try{
    const d = new Date(s);
    if (Number.isNaN(d.getTime())) return '';
    const y=d.getFullYear();
    const m=String(d.getMonth()+1).padStart(2,'0');
    const day=String(d.getDate()).padStart(2,'0');
    return `${y}-${m}-${day}`;
  }catch{ return ''; }
}

async function renderNotices(){
  const box = document.querySelector('.notice-list-box');
  if (!box) return;
  const ul = box.querySelector('ul');
  if (!ul) return;

  // ê¸°ë³¸ ë¹„ì›Œë‘ê¸°
  ul.innerHTML = '';

  // ë¹„ë¡œê·¸ì¸ ì²˜ë¦¬
  if (!isLoggedIn()){
    ul.innerHTML = `<li class="empty"><div class="inner"><p class="empty-text">ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</p></div></li>`;
    return;
  }

  try{
    // ìµœê·¼ 6ê±´ë§Œ ë…¸ì¶œ(ì›í•˜ë©´ ìˆ«ì ì¡°ì ˆ)
    const res = await fetchWithAuth('/api/notices?page=1&pageSize=6');
    if (res.status === 204){
      ul.innerHTML = `<li class="empty"><div class="inner"><p class="empty-text">í‘œì‹œí•  ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.</p></div></li>`;
      return;
    }
    if (!res.ok){
      ul.innerHTML = `<li class="empty"><div class="inner"><p class="empty-text">ê³µì§€ ë¶ˆëŸ¬ì˜¤ê¸°ì— ì‹¤íŒ¨í–ˆì–´ìš”.</p></div></li>`;
      return;
    }

    const data = await res.json(); // { page, pageSize, total, items: [...] }
    const items = Array.isArray(data.items) ? data.items : [];

    if (!items.length){
      ul.innerHTML = `<li class="empty"><div class="inner"><p class="empty-text">í‘œì‹œí•  ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.</p></div></li>`;
      return;
    }

    // li í…œí”Œë¦¿
    ul.innerHTML = items.map(n => {
      const dateStr = fmtYYYYMMDD(n.publish_at || n.created_at);
      const title = (n.pinned ? 'ğŸ“Œ ' : '') + (n.title || '(ì œëª© ì—†ìŒ)');
      // ìƒì„¸ í˜ì´ì§€ê°€ ìˆë‹¤ë©´ data-id ë‹¬ì•„ë‘ê³  ë¼ìš°íŒ…ì— í™œìš©
      return `
        <li>
          <a href="#" class="inner" data-nav="notice-list" data-notice-id="${n.id}">
            <p>${title}</p>
            <time>${dateStr}</time>
          </a>
        </li>
      `;
    }).join('');

    // í´ë¦­ ì‹œ ê³µì§€ ëª©ë¡/ìƒì„¸ë¡œ ì´ë™ (ì—¬ê¸°ì„  ëª©ë¡ìœ¼ë¡œ ì´ë™)
    ul.querySelectorAll('a.inner[data-notice-id]').forEach(a=>{
      a.addEventListener('click', (e)=>{
        e.preventDefault();
        // ìƒì„¸ í˜ì´ì§€ê°€ ìˆë‹¤ë©´: go('/mypage_notice_view.html?id=' + a.dataset.noticeId);
        go('/mypage_notice_list.html');
      });
    });
  }catch(e){
    console.error('renderNotices error', e);
    ul.innerHTML = `<li class="empty"><div class="inner"><p class="empty-text">ê³µì§€ ë¶ˆëŸ¬ì˜¤ê¸°ì— ì‹¤íŒ¨í–ˆì–´ìš”.</p></div></li>`;
  }
}

async function renderRecallToday() {
  if (!isLoggedIn()) return;

  const listBox = document.querySelector('.right-body ul');
  if (!listBox) return;

  try {
    const res = await fetchWithAuth('/api/recall/today');
    if (!res.ok) return;

    const data = await res.json();
    listBox.innerHTML = ''; // ì´ˆê¸°í™”

    // 6ê°œì›” ì „ ê¸°ë¡
    if (Array.isArray(data.sixMonths) && data.sixMonths.length > 0) {
  data.sixMonths.forEach(item => {
    const li = document.createElement('li');
    const titlePart = item.title ? ` (${item.title})` : ''; // ì œëª© ìˆì„ ë•Œë§Œ í‘œì‹œ
    li.innerHTML = `
      <a href="#" class="inner" data-rec-id="${item.recordId}">
        <p>6ê°œì›” ì „ ì˜¤ëŠ˜, íšŒê³ í•  ê°ì •ì´ ìˆì–´ìš”!${titlePart}</p>
        <time>${new Date(item.reveal_at).toISOString().slice(0,10)}</time>
      </a>`;
    listBox.appendChild(li);
  });
}

    // 12ê°œì›” ì „ ê¸°ë¡
    if (Array.isArray(data.oneYear) && data.oneYear.length > 0) {
  data.oneYear.forEach(item => {
    const li = document.createElement('li');
    const titlePart = item.title ? ` (${item.title})` : ''; // ì œëª© ìˆì„ ë•Œë§Œ í‘œì‹œ
    li.innerHTML = `
      <a href="#" class="inner" data-rec-id="${item.recordId}">
        <p>1ë…„ ì „ ì˜¤ëŠ˜, íšŒê³ í•  ê°ì •ì´ ìˆì–´ìš”!${titlePart}</p>
        <time>${new Date(item.reveal_at).toISOString().slice(0,10)}</time>
      </a>`;
    listBox.appendChild(li);
  });
}

    // ì•„ë¬´ ê²ƒë„ ì—†ìœ¼ë©´ ì•ˆë‚´ ë©”ì‹œì§€
    if ((!data.sixMonths || data.sixMonths.length === 0) &&
        (!data.oneYear || data.oneYear.length === 0)) {
      listBox.innerHTML = `<li><div class="inner"><p>íšŒê³ í•  ê°ì •ì´ ì—†ì–´ìš”</p></div></li>`;
    }

  } catch (e) {
    console.error('[renderRecallToday]', e);
  }
}


  /* ===== ì´ˆê¸°í™” & ìŠ¤í† ë¦¬ì§€ ì´ë²¤íŠ¸ ===== */
  (function init(){
    if (!isLoggedIn()) { go('/login_01.html'); return; }
    renderHeaderByAuth();
    renderNickname();
    renderProfile();
    renderTodayEmotion();
    renderMonthTitleAndStats();
        renderNotices();
        renderRecallToday();
  })();

  window.addEventListener('storage', (ev)=>{
    if (ev.key === 'accessToken'){
      meCache = null;
      renderHeaderByAuth();
      renderNickname();
      renderProfile();
      renderTodayEmotion();
      renderMonthTitleAndStats();
          renderNotices();
          renderRecallToday();
    }
  });
</script>
</body>
</html>